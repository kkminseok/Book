엘라스틱 서치가 제공하는 다양한 API를 다룰 수 있는 챕터

## 단건 문서 API

하나의 문서에 대한 조작을 진행할 수 있는 API이다.

### 색인 API

- 앞 장에서 이야기했던 API들이다. POST, PUT, id값을 추가하거나 추가하지 않아서 문서를 만들 수 있다.
- 성능 향상을 위해 라우팅 기능을 추가하여 색인을 진행할 수도 있다.
- **refresh**라는 매개변수를 통해 색인한 직후 검색할 수 있게도 할 수 있다.
  - 예상하겠지만 비용이 크게 들기에 많은 고려가 필요하다.
  
### 조회 API

- `GET`을 이용한 API들이다. _doc,_source로 조회가 가능하다.
  - _doc은 전체 메타데이터를 확인할 수 있지만, _source는 메타데이터 없이 본문만 조회 가능하다.
- 검색과 다르게 색인이 refresh되지 않은 상태에서도 변경된 내용을 확인할 수 있다.
- **필드 필터링**을 통해서 결과에 원하는 필드만 필터링해 포함시킬 수 있다.
  - _soruce_includes: 지정한 필드만을 결과에 포함한다.
  - _source_excludes: 지정한 필드외에 값을 결과에 포함한다.
  - `GET myindex2/_doc/1?_source_includes=t*` 이런식으로 와일드카드로 표현도 가능하다.
- 색인했을 때 라우팅을 지정하였다면 조회시에도 라우팅키값으로 조회해야한다.

### 업데이트 API

- PUT으로 색인이 생성가능하므로 일반적인 API와 달리 POST + _update라는 구문으로 업데이트할 수 있다.
- **업데이트 방식은 기존 문서를 수정하는게 아닌, 기존 문서와 업데이트 될 내용을 합쳐서 새 문서로 만들어 색인한다.**
- doc에 내용을 **직접 입력**하여 업데이트 할 수도 있다.
- **detect_noop**이란 업데이트 내용이 기존 문서 내용을 실질적으로 변경하는 여부를 확인하여 만약 기존 문서와 동일하면 noop 요청이라고 판단하고 쓰기 작업을 진행하지 않는다. 기본적으로 활성화되어 있다.
- 업데이트 API는 기존 문서를 읽는 동작방식을 지닌다 했는데, 만약 기존 문서가 없다면 **doc_as_upsert**라는 옵션을 통해서 새로 문서를 추가할 지 여부를 추가할 수 있다.
- script를 통한 업데이트도 가능한데, 엘라스틱서치의 자체 스크립트 언어인 painless를 사용한다. 더 궁금하면 찾아보면 될 듯 하다.
- 색인 API와 마찬가지로 라우팅과 refresh 옵션을 지정할 수 있다.


### 삭제 API

지정한 문서 하나를 삭제한다. `DELETE` 메서드를 사용하면 되고, 큰 특이사항은 없다. 조심해야할건 `DELETE [인덱스 이름]` 으로 개발자가 실수하여 doc를 지정하지 않으면 인덱스 전체가 삭제될 수 있다는 것이다.





