## 관측성에 필요한 3가지 주요 요소

- 지표: 일정한 시간 간격 동안 특정 활동을 측정한 숫자 데이터
    - 예시) cpu 사용률 같은 것, prometheus
- 로그: 특정 시점에 발생한 개별 이벤트를 기록한 데이터 항목
    - 예시) ELK Stack, Loki, ...
- 추적: 분산 시스템에서 하나의 요청이 여러 서비스/모듈을 거칠 때 그 흐름을 추적하는 데이터, 각 요청은 Trace ID로 식별, Trace는 여러 개의 Span으로 구성
    - 예시) OpenTelemetry

## 관측성 아키텍처 패턴과 안티 패턴

지표가 관측성 시스템으로 전달되는 방식으로는 2가지가 있다.

- 서버 풀링(스크래이핑): 관측성 시스템에서 지속적으로 클라이언트 지표를 수집해감.(prometheus)
- 클라이언트 푸시: 클라이언트가 지표를 관측성 시스템에 지속하여 전달

### 수동 계측과 자동 계측

- 수동 계측: 개발자가 직접 애플리케이션 코드에 Span이런것을 호출하여 계측을 수동으로 저장하는 방식. 2가지 문제점이 있음.
    - 의존성 증대로 유지보수가 어려움. 
    - 사람의 실수가 개입할 여지가 높음. 추적의 사각지대가 존재할 가능성이 높아서 잘못 추적하면 **오히려 오염된 데이터가 나올 수 있음.**
- 자동 계측: 외부 라이브러리나 프레임워크 수준에서 자동으로 추적 데이터를 생성하는 방식. 빠른 도입이 가능함. 대부분 자동 계측을 사용함.

## 관측성 기반의 애플리케이션 문제 진단

관측성 도구를 이용하여 추적 가능한 애플리케이션이 자주 마주하는 대표적인 오류들에 대한 내용

- 성능저하: cpu사용류르 메모리 사용량 등의 지표를 통해 판단이 가능
- 불안정한 컴포넌트: 특정 경로, url요청이 과부하를 일으키는것을 추적 가능함
- 재분할, 분할뇌: 분산 시스템에서 노드간의 연결이 끊겨 네트워크 파티션이 발생했을 때, 각 노드끼리 연결이 끊겨, 자신이 **리더**라고 착각하면서 동작해버리는 현상이 **분할 뇌**. 분산 시스템에서 노드의 분산 구조를 다시 계산해서 재배치하는 과정을 **재분할**이라고 함.
    - 관측성 도구를 이용하면 **지표**를 통해 리더 전환 급증 파악, IO, 네트워크 사용량이 급증함을 판단할 수 있고, **로그**를 봐서 리더 선출 관련 경고가 쏟아질 것이며, **추적**을 통해 사용자 요청이 어느 노드로 갔다가 어디에서 실패했는지 추적이 가능하다.
- 선더링 하드: 여러 개의 프로세스나 스레드가 동시에 같은 자원에 접근하려고 하면서 시스템에 과도한 부하나 병목이 발생하는 것
    - 시스템적 부하가 일어나므로 이를 관측할 수 있다.
- 연쇄 실패: 애플리케이션의 한 구성 요소가 실패하면서 다른 하위 시스템들도 실패하기 시작하는 경우를 말함.


## 총평

관측성에 대한 이야기. 괜찮았다. 여기서도 날 것의 단어들이 자주 나와서 조금 당황했다.

그리고 몇몇 기술에 대해서는 설명조차 없어서 기술에 대해 관심이 없는 사람이 읽기에는 조금 부담이 될 수도 있겠다 싶었다. ELK스택, 오픈텔레메트리 이런 개념이 그냥 독자가 당연히 알거라 생각하고 나오기에 ..
