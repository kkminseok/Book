성능테스트의 여러 유형, 몇 가지 모범 사례를 설명하는 장

## 성능 테스트 종류

성능 테스트 하는 이유를 먼저 아는 것이 중요.
밑의 질문을 이해하는 것이 필요함,

- 지연 테스트: 시작부터 끝까지의 트랜잭션 시간을 얼마나 걸립니까?
- 처리량 테스트: 현재 시스템 용량으로 몇 개의 동시 거래를 처리할 수 있습니까?
- 스트레스 테스트: 시스템의 한계점은 무엇인가요?
- 부하 테스트: 시스템이 특정 부하를 처리할 수 있나요?
- 내구성 테스트: 시스템을 장시간 실행했을 때 어떤 성능 이상이 발견될 수 있나요?
- 용량 계획 테스트: 추가 리소스를 투입했을 때 시스템이 예상대로 확장되나요?
- 성능 저하 테스트: 시스템이 부분적으로 장애가 발생햇을 때 어떻게 처리되나요?

지연 테스트와 처리량 테스트는 밀접한 관계가 있다. 처리량을 테스트하다보면 지연시간이 늘어나는 곳(변곡점)이 생기기에 개별적으로 논의되지만 거의 같이 사용된다 보면 된다.

### 탑다운 성능

자바 애플리케이션의 대규모 벤치마킹이 보통 코드의 작은 부분에서 정확한 수치를 얻는 것보다 훨씬 쉽다는 점.

### 자바 특유의 문제들

메모리 영역의 동적 튜닝과 JIT 컴파일러가 대표적

- 자바 가상 머신은 실행중인 메서드를 최적화된 기계어로 변환하기 위한 JIT 컴파일 후보를 자동으로 선정함. 만약 특정 메서드가 JIT컴파일되지 않는다면 두 가지 이유중 하나일 수 있다.
    - 메서드가 컴파일될 만큼 자주 실행되지 않는다.
    - 메서드가 너무 크거나 복잡하여 컴파일을 위한 분석이 불가능

## 성능 안티 패턴의 원인

팀 내부의 제약, 잘못된 관리 방식, 개발자 특유의 인간적인 성향 때문에 발생하기도 함.

개발자들이 잘못된 결정을 내리는 다섯 가지 주요 원인

1. 지루함
- 여러 부정적인 영향을 프로젝트에 끼칠 수 있다. 불필요하게 복잡한 코드를 넣거나 프로젝트에 맞지 않거나 잘 모르는 기술을 사용함.

2. 이력 부풀리기
- 이력서나 CV에 기술 경험을 추가하기 위해 특정 기술을 과도하게 사용하려고함.

3. 사회적 압박
- 결정을 내리는 과정에서 우려 사항이 충분히 표현되거나 논의되지 않았을 때

4. 이해부족
- 문제를 해결하기 위해 새로운 도구를 도입하려는 시도는 종종 기존 도구의 기능을 충분히 이해하지 못한 곳에서 비롯됨.

5. 문제에 대한 오해, 문제 자체의 부재
- 문제를 제대로 파악하지 않은 상태에서 해결책이 제시되는 경우

## 자바 가상 머신 성능을 위한 통계

모든 측정에는 어느정도의 오차가 포함되므로, 각 실행에서 발생할 수 있는 오차를 최소화하기 위해 반복 측정이 필요

### 오차 유형

- 무작위 오차: 측정 과정에서 발생하는 오차로, 서로 관련 없는 다양한 요인이 결과에 영향을 미치는 경우 
- 체계적 오차: 특정 요인이 지속적으로 결과 측정에 영향을 미치는 경우

**정확도**와 **정밀도** 라는 개념이 있는데, 사격을 예를 들어 정확도는 얼마나 표적지의 중앙에 가깝게 맞췄는가이고, 정밀도는 여러발 쐈을때 여러군데 맞춘게 아닌, 하나의 영역에 대해 얼마나 많이 맞췄는가에 대한 지표


## 통계 해석

애플리케이션을 측정하여 얻은 결과를 정확하게 해석하는 것이 가장 어렵다.

### 거짓 상관관계

상관관계는 인과관계를 의미하지 않는다. 즉, 두 변수가 유사한 패턴을 보인다고 해서 실제로 서로 연결되어 있다고 단정할 수 없다.

만약 A, B가 존재하면 다음과 같은 4가지 관계가 있을 수 있다.
- A가 B를 유발한다
- B가 A를 유발한다
- A와 B는 C라는 공통 요인으로 동시에 유발된다.
- A와 B 사이에는 아무런 연관이 없으며, 상관관계는 단순한 우연이다. 그럴듯해보인거에 속지 말아야함.

### 모자와 코끼리

요청수와 지연시간 그래프가 어린왕자 모자와 코끼리 같은 그림이 그려지는데 이는 다음과 같이 구성될 수 있기에 그려질 수 있다.

- 404오류같은 클라이언트는 보통 지연시간이 없다. 바로 응답이 가능하다.
- 50x오류같은 서버 오류는 보통 지연시간이 길다. 

그렇기에 들쑥날쑥한 그림이 나올 수 있다는 것이다.

## 인지적 편향과 성능 테스트

인지 편향은 인간의 뇌가 잘못된 결론을 내리게 유도하는 심리적 효과

### 환원주의적 사고 편향

시스템을 충분히 작은 부분으로 나누면 구성 요소를 이해함으로써 전체 시스템을 파악할 수 있다는 분석적 접근에 기반. 복잡한 시스템에서는 이는 성립되지 않는다. 전체 시스템이 단순히 개별 구성 요소의 합 이상이지는 않기 떄문

### 확증 편향

예를 들어서 NoSQL을 도입한다해서 테스트환경에서 빠르고 그런것들을 확인하여 도입하였으나 부수적은 문제들은 전혀 고려하지 않았기에 더 문제가 커지는 경우. 그런 생각

### 혼란 속의 행동 편향

시스템이 예상대로 동작하지 않거나 장애가 발생했을 때, 팀이 압박받는 상황에서 나타남.

### 위험 편향

사람은 본래 위험을 회피하려는 성향이 강하기에 어떤 시도를 하지 못함. 강력한 단위 테스트와 프로덕션 저하 테스트를 통해 이런 위험 편향을 상당 부분 줄일 수 있음. 다만 팀이 테스트를 신뢰하지 못한다면 발전은 어려울 것

## 전체 총평

조금 지루하였지만 그래도 성능 테스트에 대한 개념을 잡아주는데에는 좋은 챕터였다.









