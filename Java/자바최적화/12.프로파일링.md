## 프로파일링이란?

프로파일링은 애플리케이션의 성능 특성을 측정하고 분석하는 과정이다. 애플리케이션이 실행되는 동안 CPU 사용량, 메모리 사용량, 등 패턴을 모니터링하고 기록하여, **병목 현상을 찾아내는 활동**

실행 프로파일링과 메모리 프로파일링 2가지 주제가 있다.

## 프로파일링 도구

가장 많이 사용되는 오프 소스 소프트웨어는 **비주얼 가상 머신**과 **JDK 미션제어**가 있다.

- 비주얼 가상 머신: 실행, 메모리 프로파일러 모두 포함. 프로파일러 탭이 존재하여 이를 가지고 메서드의 CPU사용량 등 체크 가능
- JDK미션제어: JFR이라는 데이터 수집 프레임워크와 JMC라는 GUI도구와 같이 쓰인다. 메모리 분석, JVM 통계, 성능 병목 시각화 등 여러가지 기능을 제공한다.

## 샘플링과 세이프포인트 편향

실행 프로파일링은 스택 추적을 주기적으로 샘플링하여 스레드에서 진행중인 코드를 확인함. 어떤 파일러는 100ms마다 샘플링을 수행하는데, 이 값을 너무 잦게하면 오버헤드가 커지고 너무 늘리면 중요한 동작을 놓칠 수 있는 트레이드오프가 존재함.
샘플링은 이처럼 문제가 존재하고, **세이프포인트**에서만 수행되었는데, 이를 세이프포인트편향 이라고 한다.

이렇게 동작하면서 문제가 2가지가 발생하였는데, 모든 스레드가 세이프포인트에 도달해야 샘플링을 수행했기에 오버헤드가 컸고, 샘플은 세이프포인트 상태에 있는 애플리케이션 상태만 수집하였기에 분포를 제대로 반영하지 못할 수도 있었다.
샘플링 실행 프로파일러는 핫스팟의 C++ `GetCallTrace()` 함수를 사용하는데 이는 심각한 오버헤드를 가지고 있었음. 자바 11이후에는 그래도 크게 개선됨.

이 챕터에서는 최신 프로파일러로 **perf**, **비동기 프로파일러**, **어니스트 프로파일러**를 소개하는데, 자세히 정리할 필요는 없어보이므로 각 특징만 정리하겠다.

- perf: 하드웨어 성능 카운터를 읽어 동작하는 경량 프로파알리
- 비동기 프로파일러: 세이포포인트 편향 제거, 오버헤드 부하 줄임을 목표로 동작하는 프로파일러 , perf기반으로 만들어짐. 
- 어니스트 프로파일러: 현재 유지보수 안되고 있음.
- JFR(JDK Flight Recorder): 비동기 프로파일러와 유사한 내장 프로파일러이다.

위 기술들은 클라우드 네이티브 환경에서 적합하지 않을 수 있다. 때문에 새로운 패턴과 방법이 필요한데, **레드햇 크라이오스탯**이라는 컨테이너화된 자바/JVM 애플리케이션을 위한 JFR도구를 사용하거나 오픈텔레메트리에서 진행하고 있는 프로젝트를 기다리거나..하는 등의 방법이 있다.


## 총평

**프로파일러. 어렵다. 생소하다.** 이해 못 한 부분은 정리하지 않았는데, 실제 실무에서도 활용하면 좋다고 하고 배워서 나쁠거 없는 개념인건 알겠다. 일단 프로파일러가 어떤 개념인지 조금은 잡았으니 실제 활용할때에 다시 한 번 보면 좋을 듯 하다. 아니면 따로 추가학습을 하거나..





## 총평

내용이 조금 빈약해서 내가 찾아서 넣었다. 용어도 다르게 설명하길래(앞에서 할당 프로파일러라 했는데 뒤에서는 메모리 프로파일러라하는 등..) 내가 알아서 바꿔 넣었다. 번역가도 잘 몰라서 그냥 쓴걸까?