분산 시스템이 야기할 수 있는 문제, 해결방법 등을 다룬 챕터

## 기본적인 분산 데이터 구조

책에서 시계, ID와 사전 기록 로그 라고 되어있는데 도통 이게 어떤걸 의미하는지 몰라서 찾아봤다. 책에서는 잘 안 나와있다;

3개 모두 **여러 노드 간에 발생하는 이벤트 순서와 일관성 관리**에 초점이 맞춰져있다.

- 시게: 이벤트의 시간적인 순서를 결정함. 분산 시스템에서는 독립적인 시계를 가지고 있어서 동기화가 필요함.
    - 물리 시계(Physical Clocks): 컴퓨터의 시계. 실제 시간을 측정함. 각 노드의 물리 시계가 정확히 일치하기 어려워 이벤트 순서를 결정하는 데 한계가 존재.
    - 논리 시계(Logical Clocks): 물리적인 시간보다는 **이벤트 간의 인과간계**를 추적하는데 중점.
        - 람포트 타임스탬프(Lamport Timestamps): 이벤트에 숫자를 할당하여, 이벤트가 발생할 때마다 숫자를 증가시킴. "A가 B보다 먼저 발생했다면, A의 타임 스탬프는 B의 타임스탬프보다 작다"는 보장하지만, 그렇다해서 A가 B보다 먼저 발생했다고는 단정할 수 없다는 한계가 존재.
    - 벡터 시계(Vector Clocks): 각 노드에 벡터(배열)을 할당하여, 노드별 이벤트 카운터를 기록. **이벤트 간의 부분 순서를 정확히 파악**하고, 어떤 이벤트가 동시에 발생했는지도 알 수 있음.
- ID(Identifiers): 각 이벤트, 데이터 객체 또는 노드를 고유하게 식별하는 데 사용.
    - 고유성: ID는 전역적으로 유일해야함.
- 사전 기록 로그(Pre-commit log): 어떤 작업이 실제로 실행되기 전에 그 내용을 미리 기록하는 로그
    - 내구성 보장: 로그로 기록되어 있기에 데이터를 복구할 수 있음.
    - 원자성 보장: 분산 트랜잭션에서 모든 참여 노드가 작업을 완료하거나 실패했을 때 모든 노드가 롤백하여 원래 상태로 돌아가는 것을 보장.
    - 일관성 유지: 여러 복제본 간에 데이터 일관성 유지를 위해, 변경 사항을 로그에 기록하고 이를 다른 복제본에 전파하는 데 사용

### 직렬화

직렬화는 객체 인스턴스 상태를 바이트 스트림으로 변환하는 과정인데, 보통 JSON을 직렬화 형식으로 사용한다. 그 이유는 단순하고, 사람이 읽을 수 있고, 라이브러리 지원이 후하기 떄문이다.

그런데 직렬화된 객체의 크기와 같은 요인들이 성능 저하를 초래할 수 있어서, 대용량 고성능 애플리케이션에서는 바이너리 인코딩이 적합할 수 있다. 프로토콜 버퍼나 에이브로 등 다양한 옵션이 존재한다.

### 데이터 분할과 복제

- 데이터 샤딩: 대규모 데이터셋을 더 작고 관리하기 쉬운 하위 집합, **파티션**으로 나눔.
    - 수평 분할: 특정 키나 중요한 필드의 해시 값을 기반으로 데이터 분할
    - 수직 분할: 데이터를 열 단위로 나눔.

### CAP 정리

분산 시스템에서 잘 알려진 이론
- C(Consistency): 일관성
    - 모든 클라이언트가 어떤 노드를 연결하든 **동일한 최신 데이터를 볼 수 있어야 함**
- A(Availability): 가용성
    - 모든 요청에 대해 **항상 응답할 수 있어야 함**
- P(Partition Tolerance): 분할 내성
    - 네트워크 단절이 발생하더라도 시스템이 **계속해서 동작할 수 있어야 함**

세 가지 속성 중에서 **오직 두 가지만을 완벽하게 만족할 수 있다**는 것을 의미.

- CP 시스템: 네트워크 분할 상황에서 **일관성을 유지하는 것을 우선**시함. 데이터 동기화가 불가능 하면, 데이터 불일치를 피하기 위해 오류나 응답 거부를 함. -> 가용성 희생
    - ex) 은행 시스템, MongoDB, ...
- AP 시스템: 네트워크 분할 상황에서 **가용성을 유지** 최신 데이터가 아니여도 응답을 제공하는것에 초점
    - ex) 소셜 미디어의 '좋아요', '댓글' 기능, Dynamo DB, Cassandra, ...
- CA 시스템: **네트워크 분할을 허용하지 않는 시스템**에서만 일관성과 가용성을 동시에 보장, 사실상 **단일 노드 시스템**. 현실적으로 분산 시스템에서는 만족하기 불가능









## 총평

용어 설명도 없고 용어도 너무 난잡하게 쓰이는 감이 없지 않아 있다. 

"사전 기록 로그를 소개하겠습니다. 이 기술은 데이터베이스 시스템에서 원자성과 지속성을 보장하기 위해 널리 사용됩니다." 라고 하고 설명이 끝나는데, 내용이 불친절하다. 막연히 봤을 때 원자성과 지속성을 왜 로그를 통해서 보장되어야하는가? 에 대한 설명이 없기 때문이다. 그래서 결국 따로 찾아보고 내용을 추가할 수 밖에 없었다.

