### 도커 스웜

- 사용하는 이유
    - 하나의 호스트를 기준으로 하는 도커 확장성에 대한 고려로 인해 나옴.
- 스웜클래식, 도커 스웜모드
여러 대의 도커 서버를 하나의 클러스터로 만들어 컨테이너를 생성하는 여러 기능 제공
    - 스웜 클래식(컨테이너로서의 스웜)
        - API로 클러스터 서버를 제어하고 관리
    - 스웜모드(도커 스웜 모드)
        - 로드 밸런싱, 컨테이너 수 조절 가능
        - 안정성, 확장성 등 보장되어있어서 스웜 클래식 보다 더 많이 사용됨.
        - 엔진 자체에 분산코디네이터, 매니저, 에이전트 내장

- 분산 코디네이터: 각종 정보를 저장하고 동기화담당, 서비스 발견 등. ex) etcd, zookeeper, consul ... 
- 매니저: 클러스터 내의 서버 관리, 제어
- 에이전트: 각 서버를 제어 담당

- 매니저 노드 1개 이상(운영을 위한 홀수갯수 권장) , 워커노드는 없어도됨.

- 스웜 모드 서비스
    - 레플리카 개념을 적용.
    - 롱링 업데이트 기능 제공
        - 주기, 동시에 진행할 컨테이너 수, 업데이트 실패시 대처 적용 가능
    - global 서비스 모드
        - 스웜 클러스터 내 사용할 수 있는 모든 노드에 컨테이너를 반드시 하나씩 생성
        - 모니터링 등에 유용
    - 재균형은 자동으로 이루어지지 않으므로 레플리카셋을 수동으로 조정(줄였다가 늘렸다)하여 컨테이너를 옮겨야함.
    - 설정 정보 전달을 위한 `config`, `secret` 명령어 등 제공
- ingress 네트워크: 스웜 모드에서 사용되는 네트워크. 로드밸런서 등 제공
- 오버레이 네트워크: 클러스터내 컨테이너 ip 할당, 통신을 할 수 있게 도와줌.
- docker_gwbridge 네트워크: 외부 통신, 트래픽 종단점 역할 담당
- 스웜 모드에서 볼륨도 필요하면 상세 지정해줘야함.
    - 호스트 볼륨 매핑
    - 도커 볼륨 매핑
    - 모든 노드가 볼륨 데이터를 가지고 있기에 효율성은 좀 떨어짐. 따라서 어느 노드에서도 접근 가능한 퍼시스턴트 스토리지 같은 것을 두는게 좋음.
        - 서드파티나 nfs,dfs 등을 별도로 구성 필요.
- 노드의 상태 변경 가능(Active, Drain, Pause)
- 노드 라벨 지정 가능
- 서비스 제약 설정 가능
    - node label
    - node ID
    - node host
    - node role
    - 등..
    - 동시 설정 도 가능


