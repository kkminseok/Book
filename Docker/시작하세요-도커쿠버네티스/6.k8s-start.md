# k8s 기본
- k8s의 모든 리소스는 오브젝트 형태로 관리됨.
- `.yaml` 파일을 많이 사용
- 쿠버네티스는 도커를 포함한 많은 컴포넌트가 실행됨 (API 서버, 컨트롤러 매니저, 스케줄러 등)
- kubelet이라는 에이전트가 모든 노드에서 기본적으로 실행됨. 

# Pod 개념
- 컨테이너 애플리케이션의 기본 단위
- 1개의 포드에는 1개의 컨테이너 또는 여러 개의 컨테이너가 존재할 수 있음.

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-nginx-pod
spec:
  containers:
  - name: my-nginx-container
    image: nginx:latest
    ports:
    - containerPort: 80
      protocol: TCP
```

- apiVersion: 오브젝트 API버전, 오브젝트 종류 및 개발 성숙도에 따라 달라질 수 있음.
- kind: 리소스 종류 
- metadata: 라벨, 주석 등 부가 정보들을 입력
- spec: 리소스 생성을 위한 자세한 정보 입력

Pod를 사용하는 이유중 하나는 포드 내의 컨테이너들이 네트워크 네임스페이스 등과 같은 리눅스 네임스페이스를 공유해 사용하기 때문이다. 예시로는 포드내 nginx컨테아너와 spring 컨테이너가 있으면 spring컨테이너 내부에서 nginx포트로 curl을 보내도 nginx에서 응답을 해준다는 것이다.

기본적으로 하나의 포드는 1개의 완전한 애플리케이션이 있어야한다.
이 뜻은 nginx같은 포드를 여러개 생성하는 것이 아닌, 사이드카 라고 불리는 nginx보조 도구들같이 메인 application에 대해서 보조해주는 도구들이나 소프트웨어를 포함해서 하나의 포드로 띄우는 것이다. 이것이 도커와의 차이점이다.

# 레플리카셋 개념

레플리카셋을 사용하는 이유는 복원력 때문이다.
동일한 여러개의 포드를 생성하고 포드가 삭제되어도 다시 생성해주는 역할도 담당해주기 때문이다.
즉, 정해진 수의 동일한 포드가 항상 실행되도록 관리하고 노드에서 장애가 나도 다른 노드에서 재생성할 수 있게끔 해준다.

레플리카셋은 라벨을 기준으로 포드를 생성하고 삭제한다.
즉, 다른 포드라도 레플리카셋이 감시하고 있는 라벨이라면 해당 포드도 레플리카셋 갯수에 포함된다. 또한 라벨을 중간에 편집하여 삭제하면 해당 라벨에 대한 포드가 1개 줄었으므로 레플리카셋이 1개 더 생성하게 된다. 이는 레플리카셋의 `selector.matchLabel`항목과 일치해야한다.

- 레플리케이션 컨트롤러 방식은 고전방식이다.
  - 레플리케이션 컨트롤러와 레플리카셋의 다른 점 중 하나는 **표현식**기반의 라벨 셀럭터를 사용.
  ```yaml
  ...
  selector:
    matchExpressions:
      - key: app
        values:
          - my-nginx-pods-label
          - your-nginx-pods-label
        operator: In
    template:
  ...
  ```
  => app:my-nginx-pods-label 라벨을 가지는 포드뿐만 아니라 app:your-nginx-pods-label이라는 라벨을 가지는 포드 또한 레플리카셋 관리하에 놓이게됨.







