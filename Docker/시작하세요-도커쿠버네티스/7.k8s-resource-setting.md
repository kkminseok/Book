애플리케이션을 효율적으로 관리하기 위한 **네임스페이스, 컨피그맵, 시크릿**을 알아볼 것이다.

# 네임스페이스

- 리소스를 논리적으로 구분하는 장벽
  - 포드, 레플리카셋, 디플로이먼트, 서비스 등과 같은 쿠버네티스 리소스들이 묶여 있는 하나의 가상공간 또는 그룹이라고 생각하면 됨.
  - 라벨과 다른점은 네임스페이스가 좀 더 넓은 범위로 쓰일 수 있음
    - 특정 네임스페이스에 포드 사용량을 제어 할 수 있다.
    - 특정 네임스페이스에 사이드카를 붙이도록 할 수도 있다.
  - 사용하고자하는 오브젝트 yaml에 `metadata.namespace`를 추가하면된다.
  - 같은 네임스페이스 내의 서비스에 이름으로 접근가능.
  - 쿠버네티스의 오브젝트들은 네임스페이스에 속하거나 속하지 않을 수 있다.
    - 보통 저수준의 오브젝트들은 네임스페이스에 속하지 않음.

# 컨피그맵, 시크릿

## 컨피그맵

- 설정값을 포드에 전달한다.
- 컨피그맵은 설정값을, 시크릿은 노출되어서는 안 되는 비밀값을 저장함.
- 네임스페이스에 속하기에 네임스페이스별로 컨피그맵이 존재
- 애플리케이션에서 설정값을 가져오는 방식에는 크게 2가지가 있음
  - 컨피그맵의 값을 컨테이너의 환경 변수로 사용
    - 만약 시스템 환경 변수로부터 설정값을 가져온다면 이 방법을 사용하는게 좋음
  - 컨피그맵의 값을 포드 내부의 파일로 마운트해 사용
    - nginx.conf 등의 파일을 통해 설정값을 가져온다면 이러한 방법을 사용하는게 좋음
    - `spec.volumes`로 볼륨 정의 가능
    - `spec.containers.volumeMounts`: 컨테이너 내부의 어떤 디렉터리에 마운트할 것인지 명시
    - 키 이름이 파일이름이 되며, 저장됨.
    - 당연하게도 컨피그맵에서 특정값만 가져오도록 가능
- `--dry-run`과 `-o yaml`옵션을 사용하여 컨피그맵을 yaml파일로 바로 생성할 수 있음
  - example) `kubectl create configmap my-configmap --from-literal mykey=myvalue --dry-run -o yaml > my-configmap.yaml`
  - --dry-run옵션은 실행 가능 여부 검토를 하는 명령어 
  
## 시크릿

- 비밀번호와 같은 민감한 정보를 저장하기 위한 용도
- 컨피그맵과 사용방법은 거의 동일하나 `describe`옵션으로 데이터가 보이지 않음. 
- 기본적으로 base64로 인코딩을 함.
- 실제 포드에서는 디코딩된 값이 저장됨.
- 시크릿을 이용해서 이미지 레지스트리에 접근가능하게 할수도 있다.(타입 제공)
  - yaml파일에서는 `imagePullSecrets`을 통해 접근 가능
    - ```yaml
      spec:
        containers:
        - name: test-container
          image: alicek106.ipdisk.co.kr/busybox:latest
          args: ['tail', '-f', '/dev/null']
        imagePullSecrets:
        - name: registry-auth-registry # 시크릿 이름
      ```
- 시크릿을 이용해서 TLS키도 저장이 가능함 (타입제공)
- yaml을 배포하기 위해서는 평문을 저장해야하는 단점이 있는데 `kustomize`기능을 통하여 별도의 파일로 관리할 수 있음.
- 설정값을 변경하기 위해서는 `kubectl patch`라는 명령어로도 사용이 가능하다.
