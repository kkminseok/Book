- 각 행을 유일하게 식별할 장치가 필요한데, 그것이 바로 키(Key)이다.

### 기본 키
- 테이블의 모든 행을 유일하게 식별하는 대표 키
- 기본 키가 반드시 지켜야하는 3가지 규칙
    1. NULL을 가질 수 없다.
    2. 반드시 유일해야 한다.
    3. **값이 변하지 않아야 한다.(불변성)**

### 후보키
- 기본키가 될 수 있는 '후보 선수들'
- 기본 키가 될 수 있는 자격, **유일성**과 **최소성**을 모두 만족하는 모든 키

### 대체키
- 후보 키중에서 기본키로 선택되지 않은 나머지 키

### 외래키
- 테이블 간의 관계를 연결하는 역할

### 최소성?

- 유일성을 만족하기 위한 최소한의 컬럼갯수를 의미하는 듯함.
    - `{member_id, email}`이 값은 최소성을 위배하여 후보키가 될 수 없음 (member_id만으로도 식별 가능하기에)

-----

### 자연키

- 비즈니스 로직 안에서 자연스럽게 발생하는, 의미를 가진 데이터를 기본 키를 사용하는 것을 말함.
    - example) 주민등록번호, 도서 데이터에서의 ISBN
    - 장점: 직관성, 중복방지
    - 단점: **변경 가능성이 존재**
        - 애초에 외래키 제약 조건때문에 수정이 불가능해버림.
        - 제약조건 풀고 하기에는 데이터베이스 부하가 걸리게 될 것이다.
        - 데이터의 역사성도 훼손될 것이다. 과거 시점의 데이터가 필요해진다면?..
        - 외부 시스템과의 연동 문제


### 대리키

- 비즈니스와 무관한 값을 기본 키로 사용하는 것, 자연키의 문제를 해결함.
    - example) UUID, 랜덤값, 순차적으로 증가하는 정수
    - 장점: 비지니스와 무관하기에 유연하게 대처가능
    - 단점: 값이 크면 성능이 떨어질 수는 있다.


> 참고로 UNIQUE 제약 조건을 걸면 인덱스가 생성되어, 조회 성능이 보장된다.

**현대의 데이터베이스 설계의 표준은 대리키 - PK, 자연키 - UNIQUE로 설정한다.**

-----

### 자연 키 사용의 장점
- 조회 단순성: 요구사항에 따라 조인 없이 원하는 정보를 받아볼 수 있다, 마찬가지로 검색의 경우도 마찬가지다.

### 자연 키 사용의 단점
- 공간 낭비: 자연 키가 긴 문자열이라 치면 공간 낭비가 있을 수도 있다.
- 인덱스 단편화와 쓰기 성능저하: 들어오는 값들을 정렬된 상태로 인덱스를 생성해야하기 때문에 이 부분에서 단편화와 쓰기 성능 저하가 생길 수 있다.

### 대리 키 사용의 장점
- 뛰어난 쓰기 성능: 인덱스 구조상 정렬된 상태의 데이터를 넣으므로 AUTO_INCREMENT와 같은 순차적인 값을 사용하는 대리 키 경우 인덱스 단편화 문제가 생기지 않음.
- 외래 키 크기 최소화: 상대적으로 작은 크기의 외래 키를 사용하므로, 테이블 인덱스 전체적인 크기를 줄여 디스크 공간을 절약함.

### 대리 키 사용의 단점
- 추가 조인 발생: 하지만 대리 키가 제공하는 다른 수많은 이점이 훨씬 큼.
- 추가 인덱스 필요: 기본 키가 비즈니스와 무관한 값일 가능성이 높기에 관련 컬럼에 대해서 인덱스를 추가해줘야 한다.

**보통 실무에서는 그래도 쓰기 성능, 데이터 안정성 등 이점을 가진 대리 키를 기본키로 사용한다.**

-----

## 복합키

### 복합키가 필요한 이유?

- 하나의 키만으로는 특정값을 식별하지 못할 수 있다. 그런 경우에 대비해서 복합키를 설계하게 된다.
- 복합키는 두 개 이상의 컬럼을 함께 묶어 유일성을 확보하는 방식이다.

### 문제점

- 변화 가능성 존재: 복합키가 자연 키 기반이라 비즈니스 변화에 취약하다. 데이터 무결성 위반 위험이 존재하고 연쇄 변경에 따른 시스템 부하도 증대될 것이다.
- 외래 키 참조의 복잡성과 크기 증가: 복합키를 외래 키로 참조할 때, 복합키 모든 컬럼을 복제 해야한다.
    - 조인 쿼리가 복잡해질 가능성이 커진다.
    - 저장공간과 인덱스 성능저하, 쓰기 성능 저하가 될 수 있다.

### 대안

대리키써라~

이점으로는

- 불변성 확보
- 단순한 외래 키 참조
- 성능 향상
- 유연성 및 명확성
을 가질 수 있다.

-----

## 복합키와 다대다 관계

관계 테이블의 기본 키는 관계를 가진 두 테이블의 기본키(대리키)를 가지고 하느냐? 아니면 따로 기본 키를 두고 사용하느냐? 

### 방법1 각 대리키 기본키를 복합 기본키로 사용한다. ex) {order_id, product_id}

- 데이터의 정합성을 강력하게 지켜준다. 
    - 예를 들어서 {1,101}의 기본 키를 가지는 데이터의 추가 정보를 또 넣을 수 없음. DB단에서 막아줌.
- PK가 너무 뚱뚱하다.
    - PK가 두 개의 컬럼으로 이루어져 있어서 무겁다.
- 확장성 제약
    - 두 개의 키를 사용한다하면 하위 테이블에서 계속해서 전파되어야한다.
- ORM 사용의 불편함.
- **비즈니스 변화에 취약할 수도 있다.** (PK가 추가되는 상황이 올 수도 있음.)

**결론은 현대적인 데이터베이스 설계에서는 연결 테이블도 별도의 대리키를 사용하는 것을 권장한다.**

### 방법2 대리 키 - PK + UNIQUE 사용

연결 테이블이 별도의 대리 키를 기본키로 가지는 방향.

유니크 제약 조건을 통해 방법1의 기본키 제약조건의 정합성을 가질 수 있다.

- 유연하고 일관된 참조를 가짐. 
    - 외부에서 이 테이블의 특정 행을 참조할 때 컬럼 1개만 외래키로 사용하면 됨.
- 데이터 무결성 유지
    - UNIQUE를 사용한 정합성 보장
- 개발 편의성
- 약간의 오버헤드
    - 기본키 인덱스와 UNIQUE인덱스가 별도 생성되어 오버헤드가 있지만 무시해도 됨.

