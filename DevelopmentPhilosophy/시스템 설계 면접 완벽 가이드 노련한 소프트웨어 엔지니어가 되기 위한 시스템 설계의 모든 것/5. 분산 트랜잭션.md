분산 트랜잭션에서 일관성을 유지하기 위한 알고리즘을 설명

- 이벤트 소싱, 변경 데이터 캡처, 이벤트 기반 아키텍처(EDA) 개념에 대한 설명 진행
- 체크포인팅, 데드레터
- 사가(Saga) 패턴
- 2단계 커밋

-----

- **EDA**는 느슨한 결합, 확장성, 응답성(낮은 지연 시간)을 강화한다.
- **이벤트 소싱**은 추가 로그를 통해 이벤트로 데이터나 데이터 변경을 사항을 저장하는 패턴 이를 통해 분산 트랜잭션 일관성 유지에 도움
- **변경 데이터 캡처(CDC)**는  이벤트 변경에 대한 이벤트를 발행하고 소비자가 이를 받아서 다운스트림 서비스에 제공하여 처리하는 방식
    - 이벤트 소싱보다 일관성이 높고 지연시간이 낮음. 요청이 거의 실시간으로 처리되기 때문
- **트래잭션 감독자**는 트래잭션이 성공적으로 완료되거나 취소되게 보장하는 프로세스. 서버리스 함수나 배치 작업으로 구현이 가능.
    - 불일치 수동 검토와 보상 트랜잭션의 수동 실행을 위한 인터페이스로 먼저 구현되어야함. 
- **사가 패턴**은 분산 트랜잭션을 여러개의 로컬 트랜잭션으로 나누고, 실패한 경우 보상 트랜잭션으로 롤백하는 패턴
    - 조정을 구성하는 두 가지 방법으로는 코레오그래피(병렬)와 오케스트레이션(선형) 방법이 있다.
    - **코레오그래피**
        - 각 서비스가 로컬 트랜잭션을 수행하고 이벤트 발행. 만약 트랜잭션이 실패하면 보상 트랜잭션을 실행하라는 이벤트를 발행. 해당 이벤트를 수신 및 처리
        - 단점으로는 서비스 요청 흐름을 파악하기가 어려움, 여러 토픽을 구독해야할 수 있음.
    - **오케스트레이션**
        - 이벤트 발행은 코레오그래피와 달리 1곳에서 담당함. 선형적이라 흐름을 명확히 파악할 수는 있지만 SPOF문제점이 존재할 수 있다.

다른 트랜잭션 유형으로는 합의 알고리즘이 있는데, 내용이 커서 이 책에서는 다루지 않는다고 한다. 예시는 정족수, 팍소스, Raft, Zab등이 있다.

-----

## 총평

분산 트랜잭션은 중요한만큼 내용이 방대할 줄 알았는데 그렇지는 않았다. 
뭔가 분산트랜잭션을 보면서 느낀것은 '결국 막을 수는 없다'이다. 일어날 것이고, 이를 어떻게 대처할 것인가에 대한 초점이 맞춰져 있는 것 같았다.

