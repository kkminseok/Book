플리커라는 이미지 공유 서비스를 설계하는 장이다.

기능 요구사항은 다음과 같다.

- 사용자는 다른 사용자가 공유한 사진을 볼 수 있다.
- 사용자는 사진을 업로드할 수 있다. 
- 공유자는 자신의 사진에 대한 접근 제어를 설정할 수 있다. 
- 사진에는 미리 정의된 메타데이터 필드가 있다. 위치나 태그 같은 정보다.
- 동적 메타데이터의 예로는 파일 읽기 권한이 있는 뷰어 목록이 있다.
- 사용자는 사진에 댓글을 달 수 있다.
- 사용자는 사진을 즐겨찾기 할 수 잇다.
- 사용자는 사진 제목과 설명으로 검색할 수 있다.
- 사용자는 API 등을 통해 프로그래밍 방식으로 다운로드할 수 있다. 


썸네일을 생성하는 방식에는 2가지가 있다.

첫 번째는 클라이언트가 요청할 때마다 썸네일 생성을 요청해서 생성하는 것인데, 이 방식에는 문제가 있다. 요청은 보통 1건만 요청하는 것이 아닌, 10건 이상으로 요청이 오기에 한 번에 많은 양의 데이터를 처리해야하는 부담이 있다.

두 번째는 파일이 업로드 된 직후 썸네일을 생성하고 저장한 뒤, 뷰어가 요청할 때 이 썸네일을 제공하는 것이다. 

썸네일을 클라이언트에서 생성하는게 좋을까? 서버에서 생성하는게 좋을까?

먼저, 클라이언트에서 생성하면 백엔드를 거치지 않으므로 계산 리소스를 절약할 수 있다. 하지만 버그를 재현하거나 디버깅하기가 어렵다는 단점이 있다. CPU, 네트워크 단절 등으로 인해서 이미지 처리가 실패하면 이를 추적하기가 어렵다.
이로인해서 실제 제품을 배포하는데 많은 차질이 생길 것이며 이 과정이 매우 지루해질 것이다.

서버에서 썸네일을 생성하면은 네트워크 리소스는 더 들지만 디버깅, 테스트에 용이하다. 

-----

썸네일 페이지가 있다고 하자. 각 페이지에 10개의 썸네일이 존재하고, 1페이지에는 1~10번 썸네일이 2페이지에는 11~20번 썸네일이 존재한다.
만약 사용자가 1~10 썸네일을 보고 있는데, 새로운 썸네일이 생겼고 그 다음페이지를 본다할 때 10~19번 썸네일이 아닌 11~20번 썸네일을 포함하게 어떻게 보장할 수 있을까?

한 가지 방법은 페이지네이션에 버전을 부여해서 해당 버전에 맞게 썸네일을 표현하면 된다. 하지만 이 기법은 썸네일이 목록의 시작 부분에 추가되거나 삭제될 때만 작동한다. 
더 나은 방법은 클라이언트가 현재 첫 번째 항목이나 마지막 항목을 백엔드에 전달하는 것이다. `thumbnails?previous_last=<last_item>`이런식으로 값을 넘기는 것이다.

----- 

- 파일이나 이미지 공유 서비스에는 확장성, 가용성, 높은 다운로드 성능이 필요하다. 높은 업로드 성능과 일관성은 필요하지 않다.
- 클라이언트 사이드와 서버 사이드는 각기 트레이드오프가 존재한다. 가능하면 개발/업그레이드가 용이하게 서버 사이드가 선호된다. 
- 어떤 프로세스를 비동기적으로 처리할 수 있는가? 이러한 프로세스에 사가 패턴과 같은 기법을 사용해 확장성을 개선하고 하드웨어 비용을 줄일 수 있다.


## 총평

이미지 썸네일 관련해서는 최근 회사에서도 만든 것이라 관심있게 보긴 했다. 우리도 했던 고민들이다. 