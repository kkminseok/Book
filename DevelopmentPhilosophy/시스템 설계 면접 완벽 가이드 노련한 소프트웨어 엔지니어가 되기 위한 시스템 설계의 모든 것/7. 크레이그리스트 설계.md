크레이그리스트, 책에서 말하는 임의의 애플리케이션이다.

분류 광고 게시물을 위한 웹 애플리케이션이며, 10억 명이 넘는 사용자를 보유할 수 있다. 

모닐리스 아키텍처를 고려한 시스템 설계를 고려한 장이라고 하니, 참고하면 될 듯하다.

## 1. 요구사항

- 두 가지 사용자가 존재한다. 조회자와 게시자.
- 게시자는 게시글을 쓸 수 있다.
    - 제목
    - 설명 문단 몇 개
    - 가격, 단일 통화를 가정
    - 위치
    - 최대 10장의 사진(각 1MB)
    - 동영상, 애플리케이션 추후 버전에 추가 가능
- 조회자는 다음 요구사항이 존재한다.
    - 지난 7일 동안 특정 도시에서 작성된 모든 게시글을 보거나 검색한다. 무한 스크롤
    - 결과에 필터 적용 가능
    - 개별 게시물을 클릭해 세부 정보 볼 수 있다.
    - 이메일 등으로 게시자에 연락 가능하다.
    - 게시글 신고 기능이 있다.
- 비기능적 요구사항
    - 확장성: 단일 도시에서 최대 1,000만명의 사용자 수용
    - 높은 가용성: 99.99% 가동시간
    - 높은 성능: 조회자가 게시글을 작성 후 몇 초 내에 볼 수 있어야 한다.
    - 보안: 게시글 작성 전 로그인 필수. 

저장공간 대부분은 크레이그리스트 게시물용, 때문에 저장공간이 많이 필요하지는 않다. 이는 단일 호스트로도 충분하고, 분산 스토리지가 필요 없다.

## 2. API

- 게시글
    - 게시글 GET/PUT/DELETE
    - /search
    - /contact
    - /report
    - DELETE /old_posts
- 사용자 관리
    - /signup
    - /login
    - DELETE user

## 3. 스키마 설계

SQL을 설명하고 있는데, 여기에 따로 적지는 않겠다.

## 4.초기 고수준 아키텍처

사용자 인증 서비스와 객체 스토리지를 사용하는 모놀리스

모니터링, 알림, 로깅 서비스 추가

## 5. 모놀리스 아키텍처

면접할 때 모놀리스로 짰다는걸 두려워하지말라. 잘 설명해라라는 챕터인듯함.

전체 웹페이지를 객체 스토리지에 저장해서 사용한다는데, 이에 대한 트레이드오프는 네비게이션바 같은게 모든 게시물에서 중복된다는 것이다.

## 6. SQL 데이터베이스와 객체 스토리지 사용

객체스토리지는 이미지 파일을 넣고, SQL 데이터베이스는 게시물에 대한 정보를 저장한다.

클라이언트가 백엔드 호스트를 통해 이미지를 다운로드 받으면 백엔드 호스트에 추가적인 부담을 주고,이미지 다운로드 지연 시간을 증가시킨다.

이미지의 크기가 크지 않다면 image blob열을 가져서 데이터베이스에 저장할 수도 있다.

## 7. 마이그레이션은 번거롭다.

데이터베이스에 이미지를 저장하면 마이그레이션시 까다롭다는 단점이 있다.
로컬에 개발자가 python으로 마이그레이션 스크립트를 작성할 수도 있다. 작성할 떄는 네트워크 이슈 등으로 마이그레이션 도중 실패할 수 있음을 알고 있어야한다.
스크립트 작성 자체가 문제가 있을 수 있으므로 로깅은 필수이다.

쓰기에 대한 멱등성을 지녀야한다.

속도가 너무 오래걸리면 데이터 센터 내에서 스크립트를 실행해야한다. 

마이그레이션자체가 너무 비용이 많이 들기에 마이그레이션을 가능하면 피해야 한다. 

## 8. 게시글 작성과 읽기

