데이터 품질의 개념에 대해서부터 시작한다.
데이터 품질을 체크하는 기준들은 다음과 같다.

- 정확성: 측정값이 실제 값에 얼마나 가까운지
- 완전성: 데이터에 우리의 목적에 필요한 모든 값이 있는지
- 일관성: 다른 위치의 데이터와 동일한 값을 가지며, 다른 위치에서 동시에 동일한 데이터 변경 사항을 제공하는지
- 유효성: 데이터가 올바르게 형식화되고 값이 적절한 범위 내 있는지
- 고유성: 중복되거나 겹치는 데이터가 없는지
- 적시성: 필요할 때 데이터를 사용할 수 있는지

배치 감사작업이 필요한 이유는 개발자의 실수를 막기 위함이다. 개발자는 언제든 실수를 할 수 있기에 이를 방지하기 위한 감사 시스템을 작성해두어야 한다.
또한, 중복되거나 누락된 데이터와 같이 배치 감사만으로 찾을 수 있는 특정 문제가 있다.

배치 감사 시스템을 만들 때 고려해야할 사항은 다음과 같다.

- 실패한 작업은 경보(알림)을 발생시켜야 한다.
- 히스토리가 기록 되어야 한다.
- 감사 작업은 최대 6시간 내에 이루어져야 한다.
- 데이터베이스 쿼리는 15분 이내에 완료되어야 한다.
- 작업에는 소유자만 CRUD할 수 있다.
- 감사 작업 결과는 작업 구성에서 정의한 대로 정확해야 한다.


Backend -> 배치 감사 ETL -> 경보 알림 서비스 이렇게 구성되어있다고 하면 경보 알림 서비스는 배치 감사 ETL에서 바로 보내는게 맞을까?

책에서는 아니라고 말하고 있다. 그 이유는 경보쪽에 문제가 생겼을 때 이를 유지보수, 디버깅하기 어렵다는 것인데 어느 부분에서 문제가 생긴건지 확인하는 과정이 어렵다는 것이다.
그래서 제안하는 방법은 배치 감사 ETL은 배치 성공 여부(true/false)만 반환하고 이를 받은 백엔드 서비스가 false인 경우 경보 알림시스템에 요청을 보내서 경보를 보내게끔 하는 것이다.

감사 시스템에도 로깅과 모니터링을 수행해야하는데, 감사 결과를 기록하고, 이러한 감사 작업을 모니터링하며, 작업이 실패하면 감사 서비스가 경보를 트리거 한다.

-----

배치 감사에 사용되는 SQL에는 당연히 제약이 따를 수 밖에 없다.

- 쿼리 실행 시간 제한
    - 쿼리 구성을 10분 내로 동작할 수 있게끔 기준을 정하거나 하는 방법이 있을 수 있다.
    - 쿼리 제한시간 기준을 넘으면 잠재적 위험이 존재할 수 있으므로 경보 트리거를 발생시키도록 한다.
- Join이 포함된 쿼리는 허용하지 않는다./ 전체 테이블 스캔을 피하고 파티션 키로 쿼리를 진행한다.
- 이러한 것들을 문서화하여 서로에게 공유한다. 

-----

배치 ETL서비스가 실행할 수 있는 동시 쿼리 수에 제한을 걸어야한다. 시스템이 커질수록 쿼리량도 늘어날텐데 시간대가 겹치면 많은 리소스를 잡아먹을 수 있다.

따로 서비스를 둬서 각 쿼리가 실행하기 전에 이미 실행중인 쿼리가 있는지 검사하고 실행하는 방향으로 풀 수는 있다.

----- 

데이터 파이프라인이 계층을 가질 때 해당 계층들에 대해서 모든 감사를 진행해야한다.

만약 상위 계층에서 작업이 실패하면 다음과 같은 작업들을 수행할 수 있다.

- 상위 작업이 실패하면 하위 감사를 비활성화해 리소스를 절약한다.
- 해당 테이블 쿼리를 포함하는 다른 작업과 그 하위 작업도 비활성화한다.
- 모든 비활성화된 작업의 소유자와 모든 하위 작업의 소유자에게 경보 트리거를 진행한다.

하위 작업에 대해 조치를 취하지 않으면 잘못된 데이터가 하위 테이블로 전파될 수 있다.

-----

로깅 데이터는 다음과 같은 데이터가 있을 수 있다.

- 시작, 진행중, 성공, 실패 등의 현재 작업 상태 및 해당 상태가 기록된 시간
- 실패한 배치 ETL 서비스 데이터 베이스 쿼리. 실패 이유도 포함될 수 있으면 포함.
- 데이터베이스 쿼리 시간이 초과했을 때 
- 높은 CPU, 메모리, I/O 사용률
- 자체 DB구축하여 사용하면 높은 저장소 사용률을 지닌 쿼리.

## 총평

그냥 이런 시스템을 기업에서 만드나 생각이 들었다. 이걸 회사 팀에 도입한다면? 반응들이 좋을까도 같이 고민되었다.

나는 필요하다고느 느끼는데, 결국 돈이 되지 않는것이라 팀원들을 설득해나가야하는 과정이 필요해보였고 그 부분에서 여러 생각이 들었다.
