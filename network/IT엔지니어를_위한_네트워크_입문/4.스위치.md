스위치는 2계층에 있기에 MAC 주소를 기반으로 동작한다.

단순히 패킷을 전달하는 동작 외에도 네트워크를 분리할 수 있는 **VLAN**기능과 네트워크 루프를 방지하는 **스패닝 트리 프로토콜(STP)**같은 기능을 제공한다. 

## 스위치 장비 동작

스위치에는 MAC 주소 테이블이 존재하여  해당 테이블을 기준으로 패킷을 전달한다.

|MAC주소|포트|
|-----|----|
|AA|Eth 1|

만약 테이블에 없는 도착지 주소를 가진 패킷이 들어오면 전체 포트로 패킷을 전송함. 패킷의 도착지 주소가 테이블에 존재하면 해당 포트로만 패킷을 보냄.

스위치 동작 방식에는 **플러딩**, **어드레스 러닝**, **포워드/필터링** 3가지로 나눌 수 있다.

### 플러딩(Flooding)

- 스위치 부팅 시 네트워크 관련 정보가 하나도 없기에 허브처럼 모든 포트로 패킷을 전달하게 된다. 이러한 동작을 **플러딩**이라고 한다.

- 공격 기법으로는 스위치에 엉뚱한 MAC 주소를 습득시키게 하거나 MAC 주소 테이블을 꽉차게 해 스위치의 플러딩 동작을 유도할 수도 있다. 또는 *ARP 포이즈닝*기법을 통해 MAC주소를 바꿔치기헤 공격자에게 패킷이 전달하게끔 하는 방법도 있다.

### 어드레스 러닝

- MAC 주소 테이블을 만들고 유지하는 과정을 **어드레스 러닝**이라고 함. 
- 출발지의 MAC주소와 포트번호를 MAC 주소 테이블에 저장함.

### 포워딩/필터링

- 패킷이 들어온 경우 스위치가 도착지 MAC 주소를 확인하고 MAC 주소 테이블과 비교해 맞는 정보가 있으면 매치되는 해당 포트로 패킷을 **포워딩**한다고 함.
- 이 과정에서 다른 포트에는 패킷을 보내지 않는데, 이를 **필터링**이라고 함.
- 일반적으로 유니캐스트에 대해서만 동작하고, 브로드캐스트, 언노운 유니캐스트, 멀티캐스트는 좀 다르게 동작한다. 

여기서 "목적지 MAC과 포트는 어떻게 아나요" 라고 물어볼 수 있는데, 이는 이전 ARP브로드캐스트를 통해 알 수 있다.

호스트는 ARP 브로드캐스트/응답 과정을 통해 목적지의 MAC 주소를 학습하여 자신의 ARP 캐시에 저장하게 되는데, 이 과정중에 스위치는 ARP 요청 및 응답 패킷이 각 포트로 들어올 때마다 해당 패킷의 출발지 MAC 주소와 수신 포트 정보를 학습하여 자신의 MAC 테이블을 갱신한다.





