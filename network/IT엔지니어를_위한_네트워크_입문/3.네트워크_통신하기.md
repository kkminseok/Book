## 유니캐스트, 멀티캐스트, 브로드캐스트, 애니캐스트

- 유니캐스트: 1:1 통신
- 브로드캐스트: 1:다 통신, 모든 호스트가 목적지
- 멀티캐스트: 1:그룹 통신, 다수의 **특정 목적지**
- 애니캐스트: 1:1 통신, 동일 그룹 내의 1개 호스트가 목적지

## MAC 주소

- Media Access Control의 줄임말. 물리적인 주소를 칭함.
- 하드웨어에 고정되어있음. 
- 총 48비트의 16진수 12자리로 표현됨. 24비트씩 쪼개서 다시 표현되는데, 앞 부분을 **OUI**, 뒷 부분을 **UAA**라고함. 
    - OUI: IEEE가 제조사에 할당하는 부분
    - UAA: 각 제조사에서 네트워크 구성 요소에 할당하는 부분
- 전기 신호가 들어오면 2계층에서 데이터 형태(패킷)로 변환하여 내용을 구분한 후 도착지 MAC주소를 확인. 만약 자신의 MAC 주소와 다르면 폐기. 맞으면 상위 계층으로 전달

## IP 주소

- IP주소는 3계층 
- 옥텟(Octet)이라고 부르는 8비트 단위로 나누고, "."으로 구분됨. 10진수 표기
- 네트워크 주소와 호스트 주소 두 부분으로 나뉨.(클래스 개념의 시작)
    - A클래스: 맨 첫 옥텟이 네트워크 주소
    - B클래스: 첫 옥텟과 두 번째 옥텟까지가 네트워크 주소
    - C클래스: 세번째 옥텟까지 네트워크 주소
- 127.0.0.1, 루프백 주소는 어떤 클래스에도 속하지 않음.
- 위 클래스개념은 현대 기하급수적으로 늘어나는 IP 주소 요구를 감당하기엔 부족했음. 때문에 **CIRD(Classless Inter-Domain Routing)**, NAT, 사설IP, IPv6개념이 나옴.
    - 당연하게도 A클래스를 할당받은 조직에서 IP를 충분히 활용하지 못하고 버려지는 IP가 많아졌기에 문제가 발생.(클래스 리스)
- 클래스리스 네트워크에서는 별도의 네트워크와 호스트 주소를 나누는 구분자가 필요했고, 이를 **서브넷 마스크**라고 함.
    - 네트워크 주소는 1, 호스트 주소는 0으로 표기한 IP와 같이 표기.
    - example) 103.9.32.146 주소, 255.255.255.0 가 서브넷 마스크라면 네트워크 주소는 103.9.32.0, 호스트 주소는 0.0.0.146

- **서브네팅**이란 원래 부여된 클래스의 기준을 무시하고 새로운 네트워크-호스트 구분 기준을 사용자가 정해 네트워크를 더 쪼개 사용하는 것. 1비트 단위로 쪼개 사용하고 계산방법이 조금 복잡하다.

```text
1. 본인 IP를 2진수로 변경
2. 서브넷 마스크를 2진수로 변경
3. AND 연산을 통한 네트워크 주소 파악
4. 호스트 주소 부분을 모두 2진수 1로 변경해 브로드캐스트 주소 파악
5. 유효 IP범위 파악, 네트워크 주소 + 1은 유효 IP중 가장 작은 IP
6. 브로드캐스트 주소 -1 은 유효 IP중 가장 큰 IP
7. 2진수로 연산되어있는 결과값을 10진수로 변환

example)
IP주소: 103.9.32.146
서브넷: 255.255.255.192
------

AND결과: 103.9.32.128(네트워크 주소)
브로드캐스트 주소: 103.9.32.191
유효 첫 번째 IP: 103.9.32.129
마지막 유효 IP: 103.9.32.190
```

- 공인IP: 전 세계에서 유일해야 하는 IP 
- 사설IP: 인터넷에 연결하지 않고도 개인적으로 네트워크를 구성하여 사용하는 IP
    - 인터넷에 직접 접속하지 못하지만 **NAT**장비에서 공인 IP로 변경한 후에는 인터넷 접속이 가능
    - 보통 네트워크 주소가 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16로 되어있으면 사설 IP
- Bogon IP: 예약된 IP들, 127.0.0.0/8 같은 IP들


## TCP, UDP

MAC, IP 2계층과 2계층은 목적지를 찾아가기 위함이 목적이였다면, 4계층은 애플리케이션이 정상적으로 돌아가기 위한 다양한 작업에 관여를 함.

4계층에는 **시퀸스 번호, ACK번호, 목적지 포트 등** 존재

### TCP

- 패킷 번호, 전송 크기, 응답번호 등을 고려해 패킷이 잘 전송되었는지 확인함.
- 이런 방식으로 송신자와 수신자가 거리가 먼 경우 왕복 지연시간(RTT)가 늘어나서 대기하는 시간이 길어지는데, 한 번에 많은 패킷을 보내 응답을 하나 받도록 하는데, 한 번에 데이터를 받을 수 있는 데이터 크기를 **윈도 사이즈**라고 하고 네트워크 상황에 따라 이 값을 조절하는 것을 **슬라이딩 윈도**라고함. 알고리즘에서도 쓰이는 단어.

- 3-way handshake: 통신 전, 각 통신에 필요한 리소스를 미리 확보하는 작업. 3번의 패킷을 주고 받으며 통신을 서로 준비함.

### UDP

UDP는 TCP와 달리 데이터 유실, 순서 변경에 대한 통제를 하지 않음. 주로 음성 데이터나 실시간 스트리밍과 같은 응답시간에 민감한 경우 사용. 아무래도 통신 전 과정이나 신뢰성을 측정하는 방법이 없다보니 통신이 빠름. 30프레임 전달해야하는데 여기서 1프레임이 빠져도 사람이 눈치 못채는 것처럼 이런데에 쓰임.


## ARP

실제 통신은 IP기반으로 이루어지는데 이를 기준으로 MAC주소를 알 수 있다. 상대방의 MAC 주소를 알아낸기 위해 사용되는 프로토콜이 **ARP(Address Resoulution Protocol)**이다.

- ARP 브로드캐스트를 뿌려서 통신을 받은 목적지는 ARP프로토콜을 통해 자신의 MAC주소를 응답하고 이후 패킷이 인캡슐레이션 됨. 출발지와 목적지 IP주소와 MAC주소를 미리 알고있어야 캡슐화가 되기 때문이다.
- 패킷을 보낼때마다 ARP 브로드캐스트를 하기엔 비용이 크므로 메모리에 이 정보를 가지고 재사용한다. 
- Gratuitous ARP라는 GARP도 있는데, 이는 자신의 IP와 MAC 주소를 알릴 목적으로 사용됨. IP충돌 상황이나 상대방의 ARP 테이블을 갱신하도록 시키거나, 비슷하게 클러스터링 환경에서 갱신의 목적으로도 사용된다.

- **RARP**는 Reverse ARP의 줄임말이다. ARP와 반대로 MAC주소로 IP주소를 찾을 때 사용하는 프로토콜이다. 현재는 BOOTP, DHCP로 대체되어 사용되지 않는다.

## 서브넷과 게이트웨이

외부 네트워크와 통신하기 위해서는 게이트웨이라는 장비가 필요한데, 라우터나 L3스위치가 이 역할을 대체할 수 있다.

ARP를 통해 통신할 수는 있지만 좀 더 세밀한 목적지에 도달하지 못하는 브로드캐스트의 방식 때문에, 게이트웨이를 두어 알맞은 경로로 요청이 가도록 한다. 이 과정중에 서브넷 마스크를 통해 로컬 네트워크 통신인지, 원격지(외부)네트워크 통신인지 확인한다.

원격 통신하려면 라우터와 같은 3계층 장비가 필요한데, 실무에서는 3계층 통신이라고도 한다고 한다.(첨 들어봄)

즉, 로컬 네트워크 통신은 패킷에 도착지 MAC주소와 도착지 IP주소가 같은 장비(?)를 가리키는 반면, 원격 네트워크 통신은 MAC주소가 해당 서버의 게이트웨이 MAC주소일 수도 있기에 도착지 IP와 동일한 장비가 아닐 수 있다.






