## 프로토콜

간단히 말하면 옛날에는 네트워크 속도가 매우 느렸기에 최소한의 비용으로 데이터를 주고 받았어야했다. 그래서 2진수 비트로 이루어진 일종의 약속 즉, 프로토콜을 만들어서 통신하였다. 몇 번째 비트는 뭘 의미하고 이런거를 다 정하고 이런 약속을 지켜야 정상적인 통신이 가능하게 했다.

현대에서는 애플리케이션 레벨의 프로토콜은 텍스트 기반 프로토콜(HTTP,STOMP)가 사용되어 사람도 읽기 편하게 되어있다. 당연하게도 비트 기반 프로토콜보다 효율은 떨어지지만 확장이 쉽다.

TCP/IP 는 프로토콜이라고 부르지 않고 **프로토콜 스택**이라고 부른다. 총 4개의 부분으로 나뉘는데, 물리계층, 네트워크 계층, 전송 계층, 애플리케이션 계층으로 이루어져 있다.

## OSI 7계층

|계층|데이터| TCP/IP 프로토콜에서|
|---|---|---|
|애플리케이션 계층| Data| 애플리케이션 계층
|프레젠테이션 계층| Data| 애플리케이션 계층
|세션 계층| Data| 애플리케이션 계층
|전송 계층| Segments| 전송 계층
|네트워크 계층| Packets| 인터넷 계층
|데이터 링크 계층| Frames| 네트워크 엑세스 계층
|물리 계층| Bits| 네트워크 엑세스 계층

## OSI 7계층 이해하기

- 물리계층: 전기신호 전달하는 데 초점
    - 허브, 리피터, 케이블, 커넥터, 트랜시버, 탭
    - 주소의 개념이 없기에 전기 신호로 들어온 포트를 제외하고 모든 포트에 같은 저기 신호를 전송

- 데이터 링크 계층: 주소 정보를 정의하고 정확한 주소로 통신하게끔함.
    - 네트워크 인터페이스 카드(NIC), 스위치
        - NIC는 전기 신호를 데이터 형태로 만들고 목적지 MAC 주소와 출발지 MAC 주소를 확인하여 NIC MAC주소와 비교하고 목적지 MAC주소와 같으면 데이터 처리, 다르면 폐기한다.
        - 스위치는 데이터를 기반으로 단말들이 통신할 때 포트를 적절히 필터링하고 정확한 포트로 포워딩해줌. 허브의 단점을 개선해줌.
    - MAC 주소라는 주소 체계가 있음.
    - 전기 신호를 모아 데이터 형태로 처리하기에 데이터에 대한 에러 탐지나 고치기 역할 수행 가능

- 네트워크 계층: IP 주소와 같은 논리적인 주소 정의됨.
    - 라우터
        - IP 주소를 사용해 최적의 경로를 찾아주고 해당 경로로 패킷을 전송하는 역할

- 트랜스포트 계층: 데이터들이 정상적으로 잘 보내지도록 확인하는 역할. 중간에 유실되거나 순서가 바뀌었을대 바로 잡아주는 역할.

- 세션 계층: 프로세스끼리 연결을 성립하도록 도와주고 연결이 안정적으로 유지되도록 관리하고 작업 완료 후 연결을 끊는 역할.

- 프레젠테이션 계층: 인코딩, 암호화, 압축, 코드 변환같은 작업 진행. 

- 애플리케이션 계층: 애플리케이션 프로세스를 정의하고 애플리케이션 서비스를 수행. 프로토콜은 굉장히 많다. FTP, SMTP, HTTP, TELNET, ...

## 인캡슐레이션과 디캡슐레이션

- 인캡슐레이션: 데이터를 보내는 과정, 전송계층에서 물리계층을 지나 보내는 과정
    - 4계층, 3계층, 2계층에서 각각 자신이 필요한 정보를 비트 단위로 추가하는데 그러다보니 캡슐화되는 느낌이라 인캡슐레이션이라 불리는 듯함.
- 디캡슐레이션: 데이터를 받는 과정, 물리계층에서 유입되어 전송계층에 도달하는 과정
    - 인캡슐레이션과 반대로 2계층, 3계층, 4계층 갈수록 필요한 정보만 빼고 헤더는 벗겨서 상위계층으로 올리므로 디캡슐레이션이라고 불리는 듯함.

네트워크는 대부분 패킷이라는 작은 단위로 쪼개 보낸다. 그리고 받는 쪽에서는 이 패킷을 다시 큰 데이터 형태로 결합해 사용한다. 

디캡슐레이션 과정에서 상위 프로토콜로 올려보내줘야하기에 헤더에정보를 가지고 있어야함. 어떤 상위 프로토콜로 보내야할지? 에 대한 정보. 그렇기에 인캡슐레이션하는 쪽에서 헤더에 상위 프로토콜 지시자 정보를 포함해야한다. 이 정보를 4계층은 포트 번호, 3계층은 프로토콜 번호, 2계층은 이더 타입이라 부른다. 이 정보로 디캡슐레이션할 때 어떤 상위 계층으로 보내야할지 파악한다.

- MSS(Maximum Segment Size) : 네트워크에서 수용할 수 있는 크기를 역산정해 데이터가 4계층으로 내려올 때 적절한 크기로 쪼개질 수 있도록 유도하는 값. 보통 2계층의 데이터 값
- MTU(Maximum Transmission Unit): 네트워크에서 한 번에 보낼 수 있는 데이터 크기. 보통 4계층에서 가질 수 있는 최대 데이터 값


