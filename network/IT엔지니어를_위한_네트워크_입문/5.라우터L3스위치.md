3계층에서 동작하는 네트워크 경로를 지정해주는 장비. 현대에서는 L3 스위치와 라우터는 동일하다고 봐도 됨.

## 라우터 동작 방식과 역할

- **라우팅 테이블**개념이 존재함. 해당 테이블에 최적경로를 저장하여 패킷이 들어온 경우 해당 경로로 패킷을 보냄. 만약 라우팅 테이블에 목적지 주소가 없으면 패킷을 버림.
    - 관리자가 직접 경로를 입력하거나, 라우터끼리 정보를 교환하여 테이블을 업데이트하는 방법이 있음.
- 패킷 포워딩 과정에서 기존 2계층 헤더 정보를 제거하고, 새로운 2계층 헤더를 만듦. 
    - 과거에는 LAN용 헤더에서 WAN헤더로 바꾼다거나 하는 등.. 프로토콜 변환을 함

## 경로 지정 - 라우팅/스위칭

**홉**이란 라우터가 목적지에 도달할 때 목적지에 대한 경로가 아닌, 인접한 라우터까지만 경로를 저장하는데 이렇게 저장된 라우터로 넘어갈 때 네트워크를 넘는다는 의미로 **홉-바이-홉**라우팅이라고 한다. 논리적인 네트워크 단위라고 생각하면 된다.

이러한 이유로 라우터가 한 번에 목적지로 가는 전체 경로를 파악하는게 아닌, 최적의 넥스트 홉을 선택해 보내준다. 

- 보통 넥스트 홉을 지정할 때는 상대방 라우터의 인터페이스 IP 주소를 지정하는 방법을 사용
- 패킷에는 TTL(Time To Live) 값이 설정되어 있어서 유령 패킷이 생기지 않게 할 수 있다. 단위는 시간이 아닌 홉 단위다.

### 라우팅

라우터가 경로 정보를 얻는 방법

- 다이렉트 커넥티드: IP 주소를 입력할 때 IP주소와 서브넷 마스크로 네트워크 범위를 알 수 있는데 그 정보를 기준으로 라우팅 테이블을 만든 것.
- 스태틱 라우팅: 관리자가 목적지 네트워크와 넥스트 홉을 **직접**입력하는 것.
  - 돌아오는 패킷도 고려해야해서 맞은편에도 설정해줘야함.
  - 단점은 만약 경로에 단절이 생긴경우 유실이 생길 수 있고, 대규모 범위에서는 관리가 어렵다.
- 다이나믹 라우팅: 스태틱 라우팅 단점을 보완해 라우터끼리 정보를 교환해 네트워크 정보를 학습. **경로에 문제가 생겨도 이 상황을 인지해 대체 경로로 패킷을 포워딩함.** 때문에 대부분의 네트워크에서 다이나믹 라우팅이 사용됨.


라우터의 역할을 경로 정보를 얻는 것뿐만 아니라 경로 최적화도 진행하는데, 라우터가 수집한 원시 데이터, 정보 등은 **토폴로지 테이블**에 저장하고 최적의 경로를 저장하는 테이블을 **라우팅 테이블**이라고 한다.

### 스위칭

라우터가 경로를 지정하는 방법

책에서는 **롱기스트 매치**라는 방식을 통해 경로를 설정한다 한다. 자세한 설명은 없고 그에대한 추가설명과 다른 방식에 대해서도 간단히 정리해보겠다.

- 롱기스트 매치: 가장 구체적인(네트워크 마스크가 가장 긴) 경로를 우선적 선택. ex) 192.168.1.0/24 와 192.168.1.128/25 두 경로가 있다면 192.168.1.130으로 가는 패킷은 192.168.1.128/25 경로를 선택
- 관리 거리(Administrative Distance, AD): 경로간 신뢰도를 둬서 이동. 직접 연결된 경로는 0, 스태틱 경로는 1, OSPF는 110 이런식.
- 메트릭: 홉수, OSPF(대역폭을 역산한 값), EIGRP(지연, 부하 등 여러 값을 복합적으로 고려한 값), BGP 등 다양한 값으로 우선순위를 둬서 경로를 지정함.

이 값을 기준으로 매 번 판단하고 패킷을 전달하는 건 부하가 있기에 **캐시**개념이 존재하여 이 캐시를 먼저 확인하게 된다.


## 라우팅 설정 방법

### 다이렉트 커넥티드

다이렉트 커넥티드는 IP 주소나 서브넷 마스크를 입력하면 자동으로 생성된다. 

### 스태틱 라우팅

관리자가 직접 입력해야해서 네트워크 관리 플랫폼마다 제공하는 명령어가 있다. 명령어는 필요하면 찾아보자.

수동으로 대규모 네트워크에 대한 정보를 입력하는건 불가능에 가깝다. 때문에 KT, SK BroadBand와 같은 인터넷 사업자가 제공하는 라우터를 이용해 인터넷을 사용할 수 있게 한다.

- **디폴트 라우팅(디폴트 게이트웨이)**: 목적지 주소와 서브넷 마스크가 모두 0인 스태틱 라우팅을 디폴트 라우팅이라한다. 목적지 주소와 서브넷 마스크가 모두 0인 경우 "모든 네트워크"라는 의미가 된다.
  - 주로 인터넷 게이트웨이에 사용. 모든 네트워크 경로를 알 필요 없이, 단순히 인터넷 서비스 제공업체(ISP)의 라우터로 향하는 경우

### 다이나믹 라우팅

라우터간 정보 교환을 하기 위한 RIP, OSPF, IS-IS IGRP, EIGRP, BGP같은 다양한 라우팅 프로토콜이 존재.

위의 경우 전부 **유니캐스트 라우팅 프로토콜**이고, 이를 또 IGP(Interior Gateway Protocol), EGP(Exterior Gateway Protocol)로 나눌 수 있음.

- IGP: AS(Autonomous System, 인터넷에서 존재하는 자율 시스템.) 내에서 사용하는 라우팅 프로토콜. 동작원리에 따라 또 분류됨.
  - 디스턴스 벡터(Distance Vector): 인접한 라우터에서 경로 정보를 습득. 멀리 떨어진 라우터의 정보를 받는데 시간이 오래걸릴 수 있다.
  - 링크 스테이트(Link-State): 라우터에 연결된 링크 상태를 서로 교환하고 각 네트워크 맵을 그리는 라우팅 프로토콜. 경로 파악은 빠를 수 있지만 네트워크 규모가 커지면 경로 파악에 필요한 CPU, 메모리를 많이 먹음. 
    - 때문에 AREA단위로 네트워크를 분리해서 링크 스테이트 프로토콜의 단점을 상쇄시키려함. 
- EGP: AS간 통신에 사용하는 라우팅 프로토콜
    - AS간 연결은 외부 조직이 될 수 있어서 효율성보단 정책이 중요




따로 찾아봤을 때 요즘 기업에서는 **OSPF, EIGRP** 프로토콜, ISP간 통신에서는 **BGP** 라우팅 프로토콜을 많이 사용한다고 한다.

SDN기반 라우팅, 세그먼트 라우팅 기술도 늘어나고 있다고하니 참고하면 좋을 듯 하다~!

